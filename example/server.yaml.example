# paqet Server Configuration Example  
# Role must be explicitly set
role: "server"

# Logging configuration
log:
  level: "info"  # none, debug, info, warn, error, fatal

# Server listen configuration
listen:
  addr: ":9999"   # CHANGE ME: Server listen port (must match network.ipv4.addr port)
                  # WARNING: Do not use standard ports (80, 443, etc.) as iptables rules
                  # can affect outgoing server connections.

# Network interface settings
network:
  interface: "eth0"                          # CHANGE ME: Network interface (eth0, ens3, en0, etc.)
  # guid: "\Device\NPF_{...}"                # Windows only (Npcap).

  # IPv4 configuration
  ipv4:
    addr: "10.0.0.100:9999"                  # CHANGE ME: Server IPv4 and port (port must match listen.addr)
    router_mac: "aa:bb:cc:dd:ee:ff"          # CHANGE ME: Gateway/router MAC address

  # IPv6 configuration (optional)
  ipv6:
    addr: "[::1]:9999"                       # CHANGE ME: Server IPv6 and port (or remove if not using IPv6)
    router_mac: "aa:bb:cc:dd:ee:ff"          # CHANGE ME: Gateway/router MAC address

  # TCP flags for packet crafting (optional - will use defaults)
  tcp:
    local_flag: ["PA"]                       # Local TCP flags (Push+Ack default)

  # PCAP settings (optional - will use defaults)
  # pcap:
    # sockbuf: 8388608                         # 8MB buffer (default for server)
    # send_queue_size: 1000                    # Send queue size (default: 1000)
    # max_retries: 3                           # Max retry attempts on write failure (default: 3)
    # initial_backoff_ms: 10                   # Initial retry backoff in ms (default: 10ms)
    # max_backoff_ms: 1000                     # Maximum retry backoff in ms (default: 1000ms)

# Transport protocol configuration
transport:
  protocol: "kcp"  # Transport protocol: "kcp" or "quic"
  conn: 1          # Number of connections (1-256, default: 1)
  
  # tcpbuf: 8192   # TCP buffer size in bytes
  # udpbuf: 4096   # UDP buffer size in bytes

  # KCP protocol settings (used when protocol: "kcp")
  kcp:
    mode: "fast"              # KCP mode: normal, fast, fast2, fast3, manual

    # Manual mode parameters (only used when mode="manual")
    # nodelay: 1              # 0=disable, 1=enable
                              # Enable for lower latency & aggressive retransmission
                              # Disable for TCP-like conservative behavior
                  
    # interval: 10            # Internal update timer interval in milliseconds (10-5000ms)
                              # Lower values increase responsiveness but raise CPU usage

    # resend: 2               # Fast retransmit trigger (0-2)
                              # 0 = disabled (wait for timeout only)
                              # 1 = most aggressive (retransmit after 1 ACK skip)
                              # 2 = aggressive (retransmit after 2 ACK skips)

    # nocongestion: 1         # Congestion control: 0=enabled, 1=disabled
                              # 0 = TCP-like fair congestion control (slow start, congestion avoidance)
                              # 1 = disable congestion control for maximum speed

    # wdelay: false           # Write batching behavior
                              # false = flush immediately (low latency, recommended for real-time)
                              # true = batch writes until next update interval (higher throughput)
                              # Controls when data is actually sent to the network

    # acknodelay: true        # ACK sending behavior
                              # true = send ACKs immediately when packets are received (lower latency)
                              # false = batch ACKs (more bandwidth efficient)
                              # Setting true reduces latency but increases bandwidth usage

    # mtu: 1350              # Maximum transmission unit (50-1500)
    # rcvwnd: 1024           # Receive window size (default for server)
    # sndwnd: 1024           # Send window size (default for server)

    # Encryption settings  
    # block: "aes"                    # Encryption: aes, aes-128, aes-128-gcm, aes-192, salsa20, blowfish, twofish, cast5, 3des, tea, xtea, xor, sm4, none, null.
    key: "your-secret-key-here"       # CHANGE ME: Secret key (must match client)

    # Buffer settings (optional)
    # smuxbuf: 4194304       # 4MB SMUX buffer
    # streambuf: 2097152     # 2MB stream buffer

  # QUIC protocol settings (used when protocol: "quic")
  # QUIC is optimized for high bandwidth and many concurrent connections
  # quic:
    # Connection settings
    # max_idle_timeout: 30              # Maximum idle timeout in seconds (default: 30)
    # max_incoming_streams: 10000       # Max concurrent incoming streams (default: 1000 client, 10000 server)
    # max_incoming_uni_streams: 10000   # Max concurrent incoming unidirectional streams (default: 1000 client, 10000 server)
    
    # Flow control settings (optimized for high bandwidth)
    # initial_stream_receive_window: 6291456      # Initial stream receive window: 6 MB (default)
    # max_stream_receive_window: 25165824         # Maximum stream receive window: 24 MB (default)
    # initial_connection_receive_window: 15728640 # Initial connection receive window: 15 MB (default)
    # max_connection_receive_window: 62914560     # Maximum connection receive window: 60 MB (default)
    
    # Performance settings
    # enable_datagrams: false           # Enable QUIC datagram support (default: false)
    # enable_0rtt: true                 # Enable 0-RTT for faster reconnections (default: true)
    # keep_alive_period: 10             # Keep-alive period in seconds (default: 10)
    
    # TLS settings (server auto-generates self-signed certificate)
    # insecure_skip_verify: false       # Not used on server side

# Optional Forward Error Correction (FEC) - currently disabled
# Use these only if you need FEC for very lossy networks:
#   dshard: 10    # Data shards for FEC  
#   pshard: 3     # Parity shards for FEC

# Important: Server Firewall Configuration Required!
# 
# Since paqet uses pcap to bypass standard firewalls, you MUST configure
# iptables on the server to prevent kernel interference:
#
# sudo iptables -t raw -A PREROUTING -p tcp --dport 9999 -j NOTRACK
# sudo iptables -t raw -A OUTPUT -p tcp --sport 9999 -j NOTRACK  
# sudo iptables -t mangle -A OUTPUT -p tcp --sport 9999 --tcp-flags RST RST -j DROP
#
# Replace 9999 with your actual listen port.